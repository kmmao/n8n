# n8n 快速开始指南

## 前置要求

### 必需软件

1. **Node.js**
   - 版本: >= 22.16
   - 下载: https://nodejs.org/

2. **pnpm**
   - 版本: >= 10.18.3
   - 推荐使用 corepack 安装（见下文）

3. **corepack**（Node.js 包管理器管理工具）
   ```bash
   # 启用 corepack
   corepack enable

   # 激活正确的 pnpm 版本
   corepack prepare --activate
   ```

   **注意事项**:
   - 如果通过 Homebrew 安装 Node.js，需要单独安装 corepack:
     ```bash
     brew install corepack
     ```
   - Windows 用户需要以管理员身份运行终端执行上述命令

4. **构建工具**

   **Debian/Ubuntu:**
   ```bash
   apt-get install -y build-essential python
   ```

   **CentOS:**
   ```bash
   yum install gcc gcc-c++ make
   ```

   **macOS:**
   无需额外安装

   **Windows:**
   ```bash
   npm add -g windows-build-tools
   ```

## 安装步骤

### 1. Fork 和 Clone 仓库

```bash
# 1. 在 GitHub 上 Fork n8n 仓库
# 访问: https://github.com/n8n-io/n8n 并点击 Fork

# 2. Clone 你的 Fork
git clone https://github.com/<你的用户名>/n8n.git

# 3. 进入项目目录
cd n8n

# 4. 添加上游仓库
git remote add upstream https://github.com/n8n-io/n8n.git
```

### 2. 安装依赖

```bash
# 安装所有包的依赖并链接它们
pnpm install
```

这个命令会：
- 安装所有 monorepo 中的依赖
- 自动建立包之间的软链接（通过 pnpm workspaces）

### 3. 构建项目

```bash
# 构建所有包（重要：首次必须执行）
pnpm build > build.log 2>&1

# 检查构建是否成功
tail -n 20 build.log
```

**为什么要重定向输出？**
- 构建输出非常多，直接显示会很乱
- 保存到文件便于检查错误

## 启动 n8n

### 方式 1: 生产模式启动

```bash
pnpm start
```

访问: http://localhost:5678

### 方式 2: 开发模式启动（推荐开发时使用）

```bash
# 启动所有包的开发模式（带热重载）
pnpm dev
```

**开发模式特点**:
- ✅ 自动构建代码
- ✅ 代码变更时自动重启后端
- ✅ 代码变更时自动刷新前端
- ⚠️ 资源消耗较大

### 方式 3: 使用隧道启动（用于 Webhook 测试）

```bash
./packages/cli/bin/n8n start --tunnel
```

这会创建一个公网可访问的 URL，用于测试 Webhook。

## 选择性开发模式（性能优化）

如果你的机器性能有限，可以只运行需要的包：

### 仅后端开发
```bash
pnpm dev:be
```
排除前端包（editor-ui、design-system 等）

### 仅前端开发
```bash
pnpm dev:fe
```
运行后端服务器 + 前端开发服务器

### AI/LangChain 节点开发
```bash
pnpm dev:ai
```
只运行 AI 节点开发所需的包

### 自定义节点开发（带热重载）
```bash
N8N_DEV_RELOAD=true pnpm dev
```

**性能提示**:
- `pnpm dev` 会同时运行多个 TypeScript 编译器、文件监视器、Nodemon、Vite 开发服务器
- 在资源受限的机器上，使用选择性开发模式可以显著提升性能
- 文件监视在网络文件系统或虚拟机共享文件夹上性能较差

## 开发工作流示例

### 场景 1: 前端 UI 开发

```bash
# 终端 1: 启动后端（无监视）
pnpm start

# 终端 2: 启动前端开发服务器
cd packages/frontend/editor-ui
pnpm dev
```

### 场景 2: 自定义节点开发

```bash
# 终端 1: 监视节点包
cd packages/nodes-base
pnpm watch

# 终端 2: 运行 CLI（带热重载）
cd packages/cli
N8N_DEV_RELOAD=true pnpm dev
```

### 场景 3: 全栈功能开发

```bash
# 直接运行完整开发模式
pnpm dev
```

## 验证安装

安装成功后，你应该能够：

1. ✅ 访问 http://localhost:5678
2. ✅ 看到 n8n 欢迎页面
3. ✅ 创建第一个工作流
4. ✅ 添加节点并配置

## 常见问题

### Q1: `pnpm: command not found`
**解决方案**:
```bash
corepack enable
corepack prepare --activate
```

### Q2: 构建失败，提示 Python 或构建工具缺失
**解决方案**: 安装对应平台的构建工具（见前置要求）

### Q3: 端口 5678 已被占用
**解决方案**:
```bash
# 查找占用端口的进程
lsof -i :5678

# 杀死进程
kill -9 <PID>
```

### Q4: `pnpm dev` 运行非常慢
**解决方案**: 使用选择性开发模式，如 `pnpm dev:be` 或 `pnpm dev:fe`

### Q5: 修改代码后没有自动重载
**解决方案**:
- 检查是否在开发模式下运行（`pnpm dev`）
- 对于节点开发，确保设置了 `N8N_DEV_RELOAD=true`

## 下一步

现在你已经成功启动了 n8n，可以：

1. 📖 阅读 `03-开发工作流.md` 了解如何开发功能
2. 🧪 阅读 `04-测试指南.md` 了解如何运行测试
3. 🎨 探索 `packages/frontend/editor-ui` 了解前端结构
4. ⚙️ 探索 `packages/cli` 了解后端 API
5. 🔌 创建你的第一个自定义节点

## 有用的 VS Code 扩展

推荐安装以下扩展提升开发体验：

- **ESLint** - 代码检查
- **Volar** - Vue 3 支持
- **TypeScript Vue Plugin (Volar)** - Vue TypeScript 支持
- **Prettier** - 代码格式化
- **Code Spell Checker** - 拼写检查
- **Coverage Gutters** - 查看测试覆盖率
