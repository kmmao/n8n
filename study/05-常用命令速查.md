# n8n 常用命令速查表

## 🚀 快速开始

```bash
# 初始化项目
pnpm install              # 安装依赖
pnpm build                # 构建所有包
pnpm start                # 启动 n8n

# 开发模式
pnpm dev                  # 全栈开发模式（所有包）
pnpm dev:be               # 仅后端开发
pnpm dev:fe               # 仅前端开发
pnpm dev:ai               # AI/LangChain 节点开发
```

## 📦 构建相关

```bash
# 构建所有包
pnpm build > build.log 2>&1    # 重定向输出到文件
tail -n 20 build.log           # 查看构建结果

# 构建特定包
pnpm --filter @n8n/cli build
pnpm --filter n8n-editor-ui build

# 清理构建产物
pnpm clean

# 重置项目（清理 + 重装）
pnpm reset
```

## 🧪 测试相关

```bash
# 运行测试
pnpm test                      # 所有测试
pnpm test:affected             # 受影响的测试
pnpm --filter @n8n/cli test    # 特定包的测试

# E2E 测试
pnpm dev:e2e                   # 开发模式 E2E 测试
pnpm test:with:docker          # Docker 容器测试
pnpm test:show:report          # 查看测试报告

# 测试覆盖率
COVERAGE_ENABLED=true pnpm test

# 在包目录中运行特定测试
cd packages/cli
pnpm test src/services/workflow.service.test.ts
pnpm test --watch              # Watch 模式
```

## ✅ 代码质量

```bash
# Lint
pnpm lint                      # 检查所有包
pnpm lint:fix                  # 自动修复
pnpm lint:affected             # 检查受影响的包
cd packages/cli && pnpm lint   # 检查特定包

# 类型检查
pnpm typecheck                 # 所有包
cd packages/cli && pnpm typecheck  # 特定包

# 格式化
pnpm format                    # 格式化代码
pnpm format:check              # 检查格式

# CSS Lint
pnpm lint:styles               # 检查样式
pnpm lint:styles:fix           # 修复样式问题
```

## 🔧 开发工具

```bash
# 创建新节点
pnpm --filter @n8n/node-cli create

# 节点开发（热重载）
N8N_DEV_RELOAD=true pnpm dev

# 启动隧道（用于 Webhook 测试）
./packages/cli/bin/n8n start --tunnel

# Watch 模式（监视文件变化）
pnpm watch
```

## 📝 包管理

```bash
# 添加依赖到特定包
pnpm --filter @n8n/editor-ui add lodash
pnpm --filter @n8n/cli add -D @types/node

# 添加依赖到 workspace root
pnpm add -w some-package

# 运行特定包的脚本
pnpm --filter @n8n/editor-ui dev
pnpm --filter @n8n/cli start

# 列出所有包
pnpm ls -r

# 更新依赖
pnpm update
```

## 🌲 Git 工作流

```bash
# 创建分支
git checkout master
git pull upstream master
git checkout -b feat/new-feature

# 从 Linear 获取分支名
# 使用 Linear ticket 中建议的分支名

# 提交（遵循 Angular 规范）
git add .
git commit -m "feat(editor): Add new feature"

# PR 类型
# feat:      新功能
# fix:       Bug 修复
# docs:      文档
# refactor:  重构
# test:      测试
# perf:      性能优化
# build:     构建系统
# ci:        CI 配置
# chore:     日常任务

# 推送并创建 PR
git push origin feat/new-feature
gh pr create --draft
```

## 🐙 GitHub CLI (gh)

```bash
# 创建 PR
gh pr create                   # 交互式创建
gh pr create --draft           # 创建草稿 PR
gh pr create --title "Title" --body "Description"

# 查看 PR
gh pr list                     # 列出 PR
gh pr view 123                 # 查看特定 PR
gh pr checks                   # 查看 CI 状态

# 合并 PR
gh pr merge 123                # 合并 PR
```

## 🗂️ 目录导航技巧

```bash
# 使用 pushd/popd 而不是 cd
pushd packages/cli             # 进入目录（保存当前位置）
pnpm test
popd                           # 返回之前的目录

# 检查当前位置
pwd
```

## 🔍 调试命令

```bash
# 启动 Node.js 调试
node --inspect packages/cli/bin/n8n

# 查看进程
ps aux | grep n8n

# 查看端口占用
lsof -i :5678

# 杀死进程
kill -9 <PID>
```

## 🎯 选择性开发场景

### 场景 1: 前端 UI 开发
```bash
# 终端 1: 启动后端（无监视）
pnpm start

# 终端 2: 启动前端开发服务器
cd packages/frontend/editor-ui
pnpm dev
```

### 场景 2: 后端 API 开发
```bash
pnpm dev:be
```

### 场景 3: 自定义节点开发
```bash
# 终端 1: 监视节点包
cd packages/nodes-base
pnpm watch

# 终端 2: 运行 CLI（带热重载）
cd packages/cli
N8N_DEV_RELOAD=true pnpm dev
```

### 场景 4: 全栈功能开发
```bash
pnpm dev
```

## 🚢 Docker 相关

```bash
# 构建 Docker 镜像
pnpm build:docker

# 扫描镜像
pnpm build:docker:scan

# 测试 Docker 容器
pnpm build:docker:test
```

## 📚 文档和帮助

```bash
# 查看可用脚本
cat package.json | grep scripts -A 30

# 查看特定包的脚本
cd packages/cli
cat package.json | grep scripts -A 20

# 查看 Turbo 配置
cat turbo.json
```

## 🎨 前端特定

```bash
# Storybook
cd packages/frontend/@n8n/design-system
pnpm storybook

# 替换 CSS tokens
pnpm replace-css-tokens
```

## 🤖 后端特定

```bash
# 启动 worker
./packages/cli/bin/n8n worker

# 启动 webhook
./packages/cli/bin/n8n webhook

# 设置后端模块
pnpm setup-backend-module
```

## ⚡ 性能优化

```bash
# 只构建变更的包（Turbo 自动处理）
pnpm build

# 清理缓存
pnpm clean
rm -rf node_modules
pnpm install

# 使用过滤器减少构建范围
pnpm --filter @n8n/cli... build  # 构建 cli 及其依赖
pnpm --filter ...@n8n/cli build  # 构建依赖于 cli 的包
```

## 🔐 环境变量

```bash
# 节点热重载
N8N_DEV_RELOAD=true pnpm dev

# 测试覆盖率
COVERAGE_ENABLED=true pnpm test

# CI 环境
CI=true pnpm test
```

## 📋 常用组合命令

```bash
# 完整的代码检查流程
pnpm build && pnpm lint && pnpm typecheck && pnpm test

# 清理重建
pnpm clean && pnpm install && pnpm build

# 检查特定包
cd packages/cli && pnpm lint && pnpm typecheck && pnpm test

# 更新依赖后重建
pnpm install && pnpm build

# 提交前检查
pnpm lint:fix && pnpm format && pnpm typecheck
```

## 🆘 故障排除

```bash
# pnpm 命令未找到
corepack enable
corepack prepare --activate

# 端口被占用
lsof -i :5678
kill -9 <PID>

# 构建缓存问题
pnpm clean
rm -rf node_modules
pnpm install
pnpm build

# TypeScript 错误
pnpm build                     # 先构建依赖
cd packages/<package>
pnpm typecheck

# 测试失败
pnpm test --watch              # Watch 模式调试
pnpm test --verbose            # 详细输出
```

## 🎓 学习资源

```bash
# 查看项目文档
cat README.md
cat CONTRIBUTING.md
cat CLAUDE.md
cat packages/frontend/CLAUDE.md

# 查看 PR 规范
cat .github/pull_request_template.md
cat .github/pull_request_title_conventions.md

# 查看示例代码
ls packages/nodes-base/nodes/  # 节点示例
```

## 💡 提示

- 使用 `pnpm --filter` 可以只操作特定包，节省时间
- 开发时优先使用 `dev:be` 或 `dev:fe` 而不是 `dev`，性能更好
- 定期运行 `pnpm typecheck` 避免类型错误累积
- 使用 `pnpm test:affected` 而不是 `pnpm test` 节省 CI 时间
- Git commit 前先运行 `pnpm lint:fix && pnpm typecheck`
