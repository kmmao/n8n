# n8n å¼€å‘å·¥ä½œæµ

## åŸºç¡€å¼€å‘å¾ªç¯

### æ ‡å‡†å·¥ä½œæµç¨‹

1. **å¯åŠ¨å¼€å‘æ¨¡å¼**
   ```bash
   pnpm dev
   ```

2. **ç¼–å†™ä»£ç **
   - ä¿®æ”¹æºæ–‡ä»¶
   - è‡ªåŠ¨é‡æ–°æ„å»ºå’Œé‡è½½

3. **æµ‹è¯•ç”Ÿäº§æ¨¡å¼**
   ```bash
   pnpm build
   pnpm start
   ```

4. **åˆ›å»ºæµ‹è¯•**
   - å•å…ƒæµ‹è¯•
   - å·¥ä½œæµæµ‹è¯•ï¼ˆé’ˆå¯¹èŠ‚ç‚¹ï¼‰

5. **è¿è¡Œæµ‹è¯•**
   ```bash
   pnpm test
   ```

6. **æäº¤ä»£ç å¹¶åˆ›å»º PR**

## å¼€å‘åœºæ™¯è¯¦è§£

### åœºæ™¯ 1: å…¨æ ˆåŠŸèƒ½å¼€å‘

#### æ­¥éª¤æ¦‚è§ˆ
1. å®šä¹‰ API ç±»å‹
2. å®ç°åç«¯é€»è¾‘
3. æ·»åŠ  API ç«¯ç‚¹
4. å®ç°å‰ç«¯ UI
5. ç¼–å†™æµ‹è¯•
6. è¿è¡Œç±»å‹æ£€æŸ¥

#### è¯¦ç»†æ­¥éª¤

**1. å®šä¹‰ API ç±»å‹** (`packages/@n8n/api-types`)

```typescript
// packages/@n8n/api-types/src/myFeature.ts
export interface MyFeatureRequest {
  name: string;
  options: {
    enabled: boolean;
  };
}

export interface MyFeatureResponse {
  id: string;
  status: 'success' | 'error';
  data: unknown;
}
```

**2. å®ç°åç«¯é€»è¾‘** (`packages/cli`)

åç«¯éµå¾ª **Controller-Service-Repository** æ¨¡å¼ï¼š

```typescript
// packages/cli/src/services/myFeature.service.ts
import { Service } from '@n8n/di';
import { UnexpectedError } from '@n8n/errors';

@Service()
export class MyFeatureService {
  async processFeature(data: MyFeatureRequest): Promise<MyFeatureResponse> {
    try {
      // ä¸šåŠ¡é€»è¾‘
      return {
        id: '123',
        status: 'success',
        data: {},
      };
    } catch (error) {
      throw new UnexpectedError('Failed to process feature', { cause: error });
    }
  }
}
```

**3. æ·»åŠ  Controller** (Express REST API)

```typescript
// packages/cli/src/controllers/myFeature.controller.ts
import { Post, RestController } from '@/decorators';
import { MyFeatureRequest, MyFeatureResponse } from '@n8n/api-types';
import { MyFeatureService } from '@/services/myFeature.service';

@RestController('/my-feature')
export class MyFeatureController {
  constructor(private myFeatureService: MyFeatureService) {}

  @Post('/')
  async create(req: MyFeatureRequest): Promise<MyFeatureResponse> {
    return await this.myFeatureService.processFeature(req);
  }
}
```

**4. å®ç°å‰ç«¯**

a. **æ·»åŠ  i18n ç¿»è¯‘** (`packages/frontend/@n8n/i18n`)

```json
// packages/frontend/@n8n/i18n/locales/en/index.json
{
  "myFeature": {
    "title": "My Feature",
    "description": "This is my new feature"
  }
}
```

b. **æ›´æ–° Pinia Store** (`packages/frontend/@n8n/stores`)

```typescript
// packages/frontend/@n8n/stores/src/myFeature.store.ts
import { defineStore } from 'pinia';
import { ref } from 'vue';
import type { MyFeatureResponse } from '@n8n/api-types';

export const useMyFeatureStore = defineStore('myFeature', () => {
  const data = ref<MyFeatureResponse | null>(null);

  async function fetchData() {
    // ä½¿ç”¨ rest-api-client
    const response = await fetch('/api/my-feature');
    data.value = await response.json();
  }

  return { data, fetchData };
});
```

c. **åˆ›å»º Vue ç»„ä»¶** (`packages/frontend/editor-ui`)

```vue
<!-- packages/frontend/editor-ui/src/components/MyFeature.vue -->
<template>
  <div :class="$style.container">
    <h2>{{ i18n.baseText('myFeature.title') }}</h2>
    <p>{{ i18n.baseText('myFeature.description') }}</p>
  </div>
</template>

<script setup lang="ts">
import { useI18n } from '@n8n/composables';
import { useMyFeatureStore } from '@n8n/stores';

const i18n = useI18n();
const myFeatureStore = useMyFeatureStore();
</script>

<style module>
.container {
  padding: var(--spacing--md);
  background: var(--color--background);
}
</style>
```

**5. ç¼–å†™æµ‹è¯•**

åç«¯æµ‹è¯• (Jest):
```typescript
// packages/cli/test/unit/services/myFeature.service.test.ts
import { MyFeatureService } from '@/services/myFeature.service';

describe('MyFeatureService', () => {
  let service: MyFeatureService;

  beforeEach(() => {
    service = new MyFeatureService();
  });

  it('should process feature successfully', async () => {
    const result = await service.processFeature({
      name: 'test',
      options: { enabled: true },
    });

    expect(result.status).toBe('success');
  });
});
```

å‰ç«¯æµ‹è¯• (Vitest):
```typescript
// packages/frontend/editor-ui/src/components/__tests__/MyFeature.test.ts
import { describe, it, expect } from 'vitest';
import { mount } from '@vue/test-utils';
import MyFeature from '../MyFeature.vue';

describe('MyFeature', () => {
  it('renders correctly', () => {
    const wrapper = mount(MyFeature);
    expect(wrapper.text()).toContain('My Feature');
  });
});
```

**6. æ„å»ºå’Œç±»å‹æ£€æŸ¥**

```bash
# å¦‚æœä¿®æ”¹äº†ç±»å‹/æ¥å£ï¼Œå…ˆæ„å»º
pnpm build

# è¿è¡Œç±»å‹æ£€æŸ¥
pnpm typecheck

# æˆ–åœ¨ç‰¹å®šåŒ…ä¸­è¿è¡Œ
cd packages/cli
pnpm typecheck
```

### åœºæ™¯ 2: åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹

#### 1. ä½¿ç”¨è„šæ‰‹æ¶åˆ›å»ºèŠ‚ç‚¹

```bash
pnpm --filter @n8n/node-cli create
```

æŒ‰æç¤ºè¾“å…¥èŠ‚ç‚¹ä¿¡æ¯ã€‚

#### 2. å®ç°èŠ‚ç‚¹é€»è¾‘

```typescript
// packages/nodes-base/nodes/MyNode/MyNode.node.ts
import type {
  IExecuteFunctions,
  INodeExecutionData,
  INodeType,
  INodeTypeDescription,
} from 'n8n-workflow';

export class MyNode implements INodeType {
  description: INodeTypeDescription = {
    displayName: 'My Node',
    name: 'myNode',
    icon: 'file:myNode.svg',
    group: ['transform'],
    version: 1,
    description: 'My custom node',
    defaults: {
      name: 'My Node',
    },
    inputs: ['main'],
    outputs: ['main'],
    properties: [
      {
        displayName: 'Text',
        name: 'text',
        type: 'string',
        default: '',
      },
    ],
  };

  async execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {
    const items = this.getInputData();
    const returnData: INodeExecutionData[] = [];

    for (let i = 0; i < items.length; i++) {
      const text = this.getNodeParameter('text', i) as string;

      returnData.push({
        json: { text },
      });
    }

    return [returnData];
  }
}
```

#### 3. åˆ›å»ºå·¥ä½œæµæµ‹è¯•

```json
// packages/nodes-base/nodes/MyNode/test/MyNode.workflow.test.json
{
  "name": "My Node Workflow",
  "nodes": [
    {
      "parameters": {
        "text": "Hello World"
      },
      "name": "My Node",
      "type": "n8n-nodes-base.myNode",
      "position": [250, 300]
    }
  ],
  "connections": {}
}
```

#### 4. å¯åŠ¨å¸¦çƒ­é‡è½½çš„å¼€å‘

```bash
N8N_DEV_RELOAD=true pnpm dev
```

ç°åœ¨ä¿®æ”¹èŠ‚ç‚¹ä»£ç ä¼šè‡ªåŠ¨é‡è½½ï¼

### åœºæ™¯ 3: ä¿®å¤ Bug

#### 1. åˆ›å»ºåˆ†æ”¯

```bash
# ä»æœ€æ–°çš„ master åˆ›å»ºåˆ†æ”¯
git checkout master
git pull upstream master
git checkout -b fix/bug-description
```

#### 2. å®šä½é—®é¢˜

ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š
- VS Code è°ƒè¯•å™¨
- `console.log` / `debugger`
- Chrome DevTools (å‰ç«¯)
- Node.js Inspector (åç«¯)

#### 3. ç¼–å†™å¤ç°æµ‹è¯•ï¼ˆé‡è¦ï¼ï¼‰

```typescript
// å…ˆå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•æ¥å¤ç° bug
it('should handle edge case', () => {
  // è§¦å‘ bug çš„ä»£ç 
  expect(() => buggyFunction()).not.toThrow();
});
```

#### 4. ä¿®å¤ä»£ç 

#### 5. ç¡®è®¤æµ‹è¯•é€šè¿‡

```bash
pnpm test
```

#### 6. è¿è¡Œå—å½±å“çš„æµ‹è¯•

```bash
pnpm test:affected
```

## ä»£ç è´¨é‡æ£€æŸ¥

### åœ¨æäº¤å‰è¿è¡Œ

```bash
# ä»£ç æ£€æŸ¥
pnpm lint

# è‡ªåŠ¨ä¿®å¤ lint é—®é¢˜
pnpm lint:fix

# ç±»å‹æ£€æŸ¥
pnpm typecheck

# æ ¼å¼åŒ–ä»£ç 
pnpm format
```

### åœ¨ç‰¹å®šåŒ…ä¸­è¿è¡Œ

```bash
cd packages/cli
pnpm lint
pnpm typecheck
```

## Git å·¥ä½œæµ

### æäº¤ä»£ç 

é¡¹ç›®ä½¿ç”¨ **lefthook** è‡ªåŠ¨è¿è¡Œ git hooksï¼š
- Pre-commit: ä»£ç æ ¼å¼æ£€æŸ¥
- Pre-push: å¯èƒ½è¿è¡Œæµ‹è¯•

```bash
# æ·»åŠ ä¿®æ”¹
git add .

# æäº¤ï¼ˆéµå¾ª Angular è§„èŒƒï¼‰
git commit -m "fix(core): Fix workflow execution bug"
```

### åˆ›å»º Pull Request

1. **æ¨é€åˆ†æ”¯**
   ```bash
   git push origin your-branch-name
   ```

2. **åˆ›å»º PR**
   ```bash
   # ä½¿ç”¨ GitHub CLI
   gh pr create --draft
   ```

3. **PR æ ‡é¢˜éµå¾ªè§„èŒƒ**ï¼ˆè§ `.github/pull_request_title_conventions.md`ï¼‰
   ```
   <type>(<scope>): <summary>
   ```

   ç±»å‹:
   - `feat`: æ–°åŠŸèƒ½
   - `fix`: Bug ä¿®å¤
   - `docs`: æ–‡æ¡£
   - `refactor`: é‡æ„
   - `test`: æµ‹è¯•
   - `perf`: æ€§èƒ½ä¼˜åŒ–

   ç¤ºä¾‹:
   - `feat(editor): Add new node picker`
   - `fix(core): Fix workflow execution error`
   - `docs(api): Update API documentation`

4. **PR æè¿°åŒ…å«**
   - ä¿®æ”¹æ‘˜è¦
   - Linear ticket é“¾æ¥: `https://linear.app/n8n/issue/[TICKET-ID]`
   - æˆªå›¾/è§†é¢‘ï¼ˆå¦‚æœæ˜¯ UI ä¿®æ”¹ï¼‰
   - æµ‹è¯•è®¡åˆ’

## åŒ…ç®¡ç†æŠ€å·§

### æ·»åŠ ä¾èµ–

```bash
# åœ¨ç‰¹å®šåŒ…ä¸­æ·»åŠ ä¾èµ–
pnpm --filter @n8n/editor-ui add lodash

# æ·»åŠ å¼€å‘ä¾èµ–
pnpm --filter @n8n/editor-ui add -D @types/lodash

# åœ¨ workspace root æ·»åŠ 
pnpm add -w some-package
```

### è¿è¡Œç‰¹å®šåŒ…çš„è„šæœ¬

```bash
# ä½¿ç”¨ filter
pnpm --filter @n8n/editor-ui dev

# æˆ–è¿›å…¥ç›®å½•
cd packages/frontend/editor-ui
pnpm dev
```

## è°ƒè¯•æŠ€å·§

### åç«¯è°ƒè¯•

åœ¨ VS Code ä¸­åˆ›å»º `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Debug n8n",
      "runtimeExecutable": "pnpm",
      "runtimeArgs": ["start"],
      "console": "integratedTerminal",
      "skipFiles": ["<node_internals>/**"]
    }
  ]
}
```

### å‰ç«¯è°ƒè¯•

åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ Vue DevTools:
- Chrome: https://chrome.google.com/webstore/detail/vuejs-devtools
- Firefox: https://addons.mozilla.org/en-US/firefox/addon/vue-js-devtools/

## æ€§èƒ½åˆ†æ

### æ„å»ºæ€§èƒ½

```bash
# æŸ¥çœ‹ Turbo æ„å»ºç¼“å­˜
pnpm build --summarize

# æ¸…ç†ç¼“å­˜é‡æ–°æ„å»º
pnpm clean
pnpm build
```

### è¿è¡Œæ—¶æ€§èƒ½

- Chrome DevTools Performance tab
- Vue DevTools Performance
- Node.js --inspect flag

## ä¸‹ä¸€æ­¥

- ğŸ“– é˜…è¯» `04-æµ‹è¯•æŒ‡å—.md` äº†è§£æµ‹è¯•è¯¦æƒ…
- ğŸ“– é˜…è¯» `05-å¸¸ç”¨å‘½ä»¤.md` å¿«é€ŸæŸ¥æ‰¾å‘½ä»¤
- ğŸ“– é˜…è¯» `06-æœ€ä½³å®è·µ.md` äº†è§£ä»£ç è§„èŒƒ
